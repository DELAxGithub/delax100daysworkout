# 🏋️‍♂️ トレーニング貯金システム：要件定義

## 🎯 システム概要

トレーニング貯金システムは、ユーザーが「20分SSTを100回」のような積み重ね式の目標を設定し、継続的なトレーニングによって「貯金」を蓄積していくモチベーション向上システムです。

## ✅ 基本コンセプト

- **貯金感覚**: 小さな積み重ねが大きな成果につながる実感
- **可視化**: 進捗が一目でわかるビジュアル表現
- **達成感**: マイルストーン到達時の明確な達成体験
- **継続性**: 毎日少しずつでも積み重ねられる仕組み

---

## 📋 機能要件

### 1. SST累積カウンター

**目標**: 20分SSTワークアウトを100回完了

**要件**:
- SST（Sweet Spot Training）ワークアウトの完了回数をカウント
- 20分以上のサイクリングワークアウトで、FTPの88-94%の強度域を判定
- 現在の累積回数と100回への進捗率を表示
- 10回、25回、50回、75回、100回のマイルストーン設定

**カウント条件**:
- サイクリングワークアウトの継続時間が20分以上
- 平均パワーがFTPの88-94%の範囲内
- ワークアウトが完了状態（isCompleted = true）

### 2. 筋トレボリューム貯金

**目標**: 部位別セット数の累積管理（Push/Pull/Legs）

**要件**:
- Push（胸・肩・三頭）: 月間120セット目標
- Pull（背中・二頭）: 月間100セット目標  
- Legs（脚・臀部・体幹）: 月間80セット目標
- 各部位の月間累積セット数と目標達成率を表示
- 週単位での進捗確認とペース調整提案

**カウント条件**:
- StrengthDetail の exercise 名から部位を自動判定
- sets × reps でボリューム計算ではなく、セット数のみカウント
- 月初にリセット、月末に達成バッジ判定

### 3. 柔軟性継続ストリーク

**目標**: 開脚・前屈の継続記録と角度改善

**要件**:
- 前後開脚の継続日数ストリーク
- 左右開脚の継続日数ストリーク
- 前屈の継続日数ストリーク
- 各項目の最長ストリーク記録
- 角度・距離の改善トレンド表示

**カウント条件**:
- FlexibilityDetail に前後開脚、左右開脚、前屈のいずれかが記録
- 1日1回以上の記録でストリーク継続
- 24時間以内に記録がない場合はストリーク中断

### 4. 達成バッジシステム

**目標**: 各貯金システムのマイルストーン達成時のバッジ付与

**要件**:
- SST貯金バッジ（10回、25回、50回、75回、100回）
- ボリューム貯金バッジ（月間目標達成、3ヶ月連続達成）
- ストリークバッジ（7日、30日、60日、100日連続）
- 総合バッジ（全システム同時達成）

---

## 🔧 非機能要件

### パフォーマンス
- データ取得・更新処理は2秒以内
- UI描画の遅延なし（60fps維持）

### ユーザビリティ
- 直感的な進捗表示（プログレスバー、円グラフ等）
- 色覚に配慮したカラーリング
- アクセシビリティ対応（VoiceOver等）

### データ整合性
- 既存WorkoutRecord、Achievement システムとの整合性維持
- データ重複・欠損の防止
- バックアップ・復元対応

---

## 🎨 UI/UX要件

### 貯金ダッシュボード
- 4つの貯金システムの現在状況を一覧表示
- タップで詳細画面に遷移
- 進捗アニメーション（数値カウントアップ等）

### 詳細画面
- 履歴グラフ（時系列での積み重ね推移）
- 次のマイルストーンまでの残り表示
- 過去の達成バッジ一覧

### 通知・フィードバック
- マイルストーン達成時のお祝い表示
- ストリーク継続中の励ましメッセージ
- 目標ペースから遅れている場合の調整提案

---

## 🔄 既存システムとの連携

### WorkoutRecord連携
- CyclingDetail からSST判定
- StrengthDetail から部位別セット数抽出
- FlexibilityDetail からストリーク判定

### Achievement システム拡張
- 新たな達成タイプ「savings」を追加
- 既存のPR、ストリーク、マイルストーン、改善と統合

### ProgressAnalyzer 拡張
- 貯金システム専用の分析機能追加
- AI分析データに貯金進捗を含める

---

## 📊 データ仕様

### TrainingSavings モデル
```swift
@Model
final class TrainingSavings {
    var savingsType: SavingsType
    var currentCount: Int
    var targetCount: Int
    var lastUpdated: Date
    var achievedMilestones: [Int]
    // リレーション: Achievement, WorkoutRecord
}

enum SavingsType: String, Codable {
    case sstCounter = "SST累積"
    case pushVolume = "Push貯金"
    case pullVolume = "Pull貯金"
    case legsVolume = "Legs貯金"
    case forwardSplitStreak = "前後開脚ストリーク"
    case sideSplitStreak = "左右開脚ストリーク"
    case forwardBendStreak = "前屈ストリーク"
}
```

### バッジ定義
- SST: [10, 25, 50, 75, 100]
- ボリューム: [月間目標達成, 3ヶ月連続]
- ストリーク: [7, 30, 60, 100]

---

## 🚀 成功指標

### ユーザーエンゲージメント
- トレーニング完了率の向上（目標：+20%）
- アプリ利用頻度の向上（目標：週5回以上）
- ストリーク継続率の向上（目標：30日以上50%）

### システム利用率
- 貯金ダッシュボード閲覧率（目標：90%以上）
- マイルストーン達成率（目標：初回マイルストーン80%以上）
- バッジ収集完了率（目標：基本バッジ70%以上）

---

## 📝 制約事項

### 技術的制約
- 既存コードベースへの影響最小限
- SwiftData スキーマ変更時の移行対応
- iOS 17.0以降のみサポート

### ビジネス制約
- 開発期間：2週間以内
- 追加のライブラリ依存なし
- 既存ユーザーデータの後方互換性維持

---

## 🔮 将来拡張

### Phase 2候補
- 友達との進捗共有・競争機能
- カスタム目標設定（ユーザー定義貯金）
- AI による最適ペース提案
- Apple HealthKit連携
- ウィジェット対応

### Phase 3候補
- ソーシャル機能（ランキング、チャレンジ）
- ゲーミフィケーション要素（レベルアップ、アバター）
- データエクスポート・インポート機能